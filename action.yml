name: 'DingTalk Notification'
description: 'Send messages to DingTalk via Golang CLI'

inputs:
  webhook:
    description: '钉钉 Webhook 地址'
    required: true
  secret:
    description: '加签密钥（可选）'
    required: false
    default: ""
  message:
    description: '消息内容'
    required: true
  at_mobiles:
    description: '@手机号（逗号分隔，可选）'
    required: false
    default: ""
  markdown:
    description: '是否使用 Markdown'
    required: false
    default: "false"
  title:
    description: 'Markdown 标题（可选）'
    required: false
    default: "Notification"

runs:
  using: docker
  image: 'docker://ghcr.io/pascall-tool/robot-dingtalk-go/robot-dingtalk-go:v1'
  env:
    WEBHOOK: ${{ inputs.webhook }}
    SECRET: ${{ inputs.secret }}
    MESSAGE: ${{ inputs.message }}
    AT_MOBILES: ${{ inputs.at_mobiles }}
    MARKDOWN: ${{ inputs.markdown }}
    TITLE: ${{ inputs.title }}
  entrypoint: /bin/sh
  args:
    - -c
    - |
      dingtalk-action send \
        --webhook "$WEBHOOK" \
        --secret "$SECRET" \
        --msg "$MESSAGE" \
        --at "$AT_MOBILES" \
        --md "$MARKDOWN" \
        --title "$TITLE"